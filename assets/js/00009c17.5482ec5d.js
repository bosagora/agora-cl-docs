"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6208],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),d=s(n),g=r,m=d["".concat(l,".").concat(g)]||d[g]||p[g]||o;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:r,i[1]=c;for(var s=2;s<o;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1262:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294),r=n(2263);const o=function(e){var t=e.children,n=e.fallback;return(0,r.Z)().isClient&&null!=t?a.createElement(a.Fragment,null,t()):n||null}},5505:(e,t,n)=>{n.d(t,{M:()=>o});var a=n(7294),r=n(1262),o=function(e){var t=e.commaDelimitedContributors,n=e.lastVerifiedDateString,o=e.lastVerifiedVersionString,i={Chris:"hewison-chris"},c=function(e){return a.createElement("a",{class:"header-badge",href:"https://github.com/"+i[e]},a.createElement("span",{class:"badge-avatar",style:{backgroundImage:"url('https://avatars.githubusercontent.com/"+i[e]+"')"}}),a.createElement("span",{class:"badge-label"},e))};return a.createElement(r.Z,null,(function(){return a.createElement("div",{class:"header-badges"},null!=t?t.split(",").map(c):null,function(e,t){if(null!=e&&null!=t)return a.createElement("a",{class:"header-badge"},a.createElement("span",{class:"badge-avatar emoji-avatar"},"\u2714\ufe0f"),a.createElement("span",{class:"badge-label"},"Last verified on ",a.createElement("strong",null,e)," using Agora-cl ",t))}(n,o),a.createElement("a",{class:"header-badge",href:"https://github.com/Bosagora/documentation/issues/new?title=Docs update request: "+new URL(window.location.href).pathname+"&body=Source: "+window.location.href+"%0A%0ARequest: (how can we help?)"},a.createElement("span",{class:"badge-avatar emoji-avatar"},"\u270f\ufe0f"),a.createElement("span",{class:"badge-label"},"Request an update")))}))}},1144:(e,t,n)=>{n.d(t,{M:()=>o});var a=n(7294),r=n(1262),o=function(e){return function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(e),a.createElement(r.Z,null,(function(){return a.createElement("div",{class:"update-request"},a.createElement("a",{href:"https://https://github.com/zeroone-boa/agora-cl-docs/issues/new?title=Docs update request: "+new URL(window.location.href).pathname+"&body=Source: "+window.location.href+"%0A%0ARequest: (how can we help?)"},"\ud83d\udc3c Request an update"))}))}},8140:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>u,default:()=>m,frontMatter:()=>s,metadata:()=>p,toc:()=>d});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=n(5505),c=n(1144),l=["components"],s={id:"golang-principles",title:"Golang principles",sidebar_label:"Golang principles"},u=void 0,p={unversionedId:"contribute/golang-principles",id:"contribute/golang-principles",isDocsHomePage:!1,title:"Golang principles",description:"Prysmatic Labs sticks to the official Effective Go guidelines, and all code committed to Agora-cl's master branch goes through extensive lint tools that check formatting correctness and review potential security flaws in the code itself.",source:"@site/docs/contribute/agora-cl-golang-principles.md",sourceDirName:"contribute",slug:"/contribute/golang-principles",permalink:"/docs/contribute/golang-principles",editUrl:"https://github.com/zeroone-boa/agora-cl-docs/edit/master/website/docs/contribute/agora-cl-golang-principles.md",version:"current",frontMatter:{id:"golang-principles",title:"Golang principles",sidebar_label:"Golang principles"},sidebar:"docs",previous:{title:"Contribute to Agora-cl's codebase",permalink:"/docs/contribute/contribution-guidelines"},next:{title:"Golang resources",permalink:"/docs/reading/golang"}},d=[{value:"Code comments",id:"code-comments",children:[]},{value:"Naming",id:"naming",children:[]},{value:"Error handling",id:"error-handling",children:[]}],g={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,l);return(0,o.kt)("wrapper",(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)(i.M,{mdxType:"HeaderBadgesWidget"}),(0,o.kt)("p",null,"Prysmatic Labs sticks to the official ",(0,o.kt)("a",{parentName:"p",href:"https://golang.org/doc/effective_go.html"},"Effective Go guidelines"),", and all code committed to Agora-cl's master branch goes through extensive lint tools that check formatting correctness and review potential security flaws in the code itself."),(0,o.kt)("p",null,"For a recommended book on the Go language, see 'The Go Programming Language' by Alan A. A. Donovan and Brian Kernighan, available for purchase on Amazon ",(0,o.kt)("a",{parentName:"p",href:"https://www.amazon.com/Programming-Language-Addison-Wesley-Professional-Computing/dp/0134190440"},"here"),"."),(0,o.kt)("h2",{id:"code-comments"},"Code comments"),(0,o.kt)("p",null,"Prysmatic requires all code to adhere to correct commentary conventions for any new packages in order to generate proper Godocs."),(0,o.kt)("h4",{id:"good"},"Good:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"// ExecuteStateTransition transforms the current state of a Agora node by applying the\n// transformations specified in the official Ethereum Serenity specification.\nfunc ExecuteStateTransition(state *pb.BeaconState, block *pb.BeaconBlock) (*pb.BeaconState, error) {\n...\n}\n")),(0,o.kt)("h4",{id:"bad"},"Bad:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"// This function executes a state transition.\nfunc ExecuteStateTransition(state *pb.BeaconState, block *pb.BeaconBlock) (*pb.BeaconState, error) {\n...\n}\n")),(0,o.kt)("h2",{id:"naming"},"Naming"),(0,o.kt)("p",null,"Ensure your names are clear, concise and make no assumptions about your code without explaining the surrounding context with good commentary. Additionally, ensure all variables are namespaced properly and have a clear purpose to the reader of your code."),(0,o.kt)("h4",{id:"good-1"},"Good:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"// justificationUpperLimit defines a ceiling after which a block cannot pass processing conditions\n// as defined in the Ethereum Serenity specification.\njustificationUpperLimit := params.BeaconConfig().SlotDuration*params.BeaconConfig().JustificationBoundary\nIf block.Slot() > justificationUpperLimit {\n...\n}\n")),(0,o.kt)("h4",{id:"bad-uses-magic-numbers-with-no-explanation-or-context"},"Bad ","(","uses magic numbers with no explanation or context",")",":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"If block.Slot() > 12032*(23 + 45 % 15) {\n}\n")),(0,o.kt)("h2",{id:"error-handling"},"Error handling"),(0,o.kt)("p",null,"Always handle fatal situations gracefully through informative error messaging or logging. Error handling is critical in code paths where critical state mutations occur which affect data persisted to disk. In particular, not handling an error gracefully a few lines above where data is written to disk can cause the system to remain in an inconsistent state ","(","one of the most critical types of failures",")","."),(0,o.kt)("p",null,"For example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"func UpdateBeaconState(currentState *pb.BeaconState, blockCh chan<- *types.Block) {\n  For {\n    select {\n      Case block :=<-blockCh:\n        If err != processBlock(block); err != nil {\n          log.Errorf(\u201cblock failed processing conditions: %v\u201d, err)\n        }\n        newState := executeStateTransition(currentState, block)\n        // BAD: This can lead to a critical, inconsistent state! The line below will save to DB\n        // DB even if block failed processing conditions!\n        db.SaveState(newState)\n    }\n  }\n}\n")),(0,o.kt)("p",null,"Instead, ensure to handle all errors in critical code paths appropriately. The error above can easily be fixed by a ",(0,o.kt)("inlineCode",{parentName:"p"},"continue")," line added after the ",(0,o.kt)("inlineCode",{parentName:"p"},"log.Errorf")," call to continue the loop and not store a bad state to disk."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"func UpdateBeaconState(currentState *pb.BeaconState, blockCh chan<- *types.Block) {\n  For {\n    select {\n      Case block :=<-blockCh:\n        If err != processBlock(block); err != nil {\n          log.Errorf(\u201cblock failed processing conditions: %v\u201d, err)\n          // GOOD: The line below won't save to DB if block failed processing conditions.\n          continue\n        }\n        newState := executeStateTransition(currentState, block)\n        db.SaveState(newState)\n    }\n  }\n}\n")),(0,o.kt)(c.M,{mdxType:"RequestUpdateWidget"}))}m.isMDXComponent=!0}}]);