"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6484],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),l=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=l(e.components);return a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=l(n),h=o,m=d["".concat(c,".").concat(h)]||d[h]||u[h]||r;return n?a.createElement(m,i(i({ref:t},p),{},{components:n})):a.createElement(m,i({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1262:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(7294),o=n(2263);const r=function(e){var t=e.children,n=e.fallback;return(0,o.Z)().isClient&&null!=t?a.createElement(a.Fragment,null,t()):n||null}},8215:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294);const o=function(e){var t=e.children,n=e.hidden,o=e.className;return a.createElement("div",{role:"tabpanel",hidden:n,className:o},t)}},5064:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(7294),o=n(9443);const r=function(){var e=(0,a.useContext)(o.Z);if(null==e)throw new Error('"useUserPreferencesContext" is used outside of "Layout" component.');return e};var i=n(6010);const s="tabItem_1uMI",c="tabItemActive_2DSg";var l=37,p=39;const u=function(e){var t=e.lazy,n=e.block,o=e.defaultValue,u=e.values,d=e.groupId,h=e.className,m=r(),k=m.tabGroupChoices,g=m.setTabGroupChoices,f=(0,a.useState)(o),b=f[0],y=f[1],v=a.Children.toArray(e.children),N=[];if(null!=d){var w=k[d];null!=w&&w!==b&&u.some((function(e){return e.value===w}))&&y(w)}var C=function(e){var t=e.currentTarget,n=N.indexOf(t),a=u[n].value;y(a),null!=d&&(g(d,a),setTimeout((function(){var e,n,a,o,r,i,s,l;(e=t.getBoundingClientRect(),n=e.top,a=e.left,o=e.bottom,r=e.right,i=window,s=i.innerHeight,l=i.innerWidth,n>=0&&r<=l&&o<=s&&a>=0)||(t.scrollIntoView({block:"center",behavior:"smooth"}),t.classList.add(c),setTimeout((function(){return t.classList.remove(c)}),2e3))}),150))},x=function(e){var t,n;switch(e.keyCode){case p:var a=N.indexOf(e.target)+1;n=N[a]||N[0];break;case l:var o=N.indexOf(e.target)-1;n=N[o]||N[N.length-1]}null==(t=n)||t.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.Z)("tabs",{"tabs--block":n},h)},u.map((function(e){var t=e.value,n=e.label;return a.createElement("li",{role:"tab",tabIndex:b===t?0:-1,"aria-selected":b===t,className:(0,i.Z)("tabs__item",s,{"tabs__item--active":b===t}),key:t,ref:function(e){return N.push(e)},onKeyDown:x,onFocus:C,onClick:C},n)}))),t?(0,a.cloneElement)(v.filter((function(e){return e.props.value===b}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},v.map((function(e,t){return(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==b})}))))}},9443:(e,t,n)=>{n.d(t,{Z:()=>a});const a=(0,n(7294).createContext)(void 0)},1144:(e,t,n)=>{n.d(t,{M:()=>r});var a=n(7294),o=n(1262),r=function(e){return function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(e),a.createElement(o.Z,null,(function(){return a.createElement("div",{class:"update-request"},a.createElement("a",{href:"https://https://github.com/zeroone-boa/agora-cl-docs/issues/new?title=Docs update request: "+new URL(window.location.href).pathname+"&body=Source: "+window.location.href+"%0A%0ARequest: (how can we help?)"},"\ud83d\udc3c Request an update"))}))}},4762:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>u,default:()=>k,frontMatter:()=>p,metadata:()=>d,toc:()=>h});var a=n(7462),o=n(3366),r=(n(7294),n(3905)),i=n(5064),s=n(8215),c=n(1144),l=["components"],p={id:"checkpoint-sync",title:"Sync from a checkpoint",sidebar_label:"Sync from a checkpoint"},u=void 0,d={unversionedId:"agora-cl-usage/checkpoint-sync",id:"agora-cl-usage/checkpoint-sync",isDocsHomePage:!1,title:"Sync from a checkpoint",description:"This feature is currently in public preview and may change significantly as we receive feedback from users like you. Join our Bosagora Telegram to share your feedback.",source:"@site/docs/agora-cl-usage/checkpoint-sync.md",sourceDirName:"agora-cl-usage",slug:"/agora-cl-usage/checkpoint-sync",permalink:"/docs/agora-cl-usage/checkpoint-sync",editUrl:"https://github.com/zeroone-boa/agora-cl-docs/edit/master/website/docs/agora-cl-usage/checkpoint-sync.md",version:"current",frontMatter:{id:"checkpoint-sync",title:"Sync from a checkpoint",sidebar_label:"Sync from a checkpoint"},sidebar:"docs",previous:{title:"Stay up to date",permalink:"/docs/agora-cl-usage/staying-up-to-date"},next:{title:"Run a slasher",permalink:"/docs/agora-cl-usage/slasher"}},h=[{value:"Option 1: Configure checkpoint sync via network request",id:"option-1-configure-checkpoint-sync-via-network-request",children:[{value:"Serve checkpoint sync requests",id:"serve-checkpoint-sync-requests",children:[]}]},{value:"Option 2 (Advanced): Configure checkpoint sync via file export/import",id:"option-2-advanced-configure-checkpoint-sync-via-file-exportimport",children:[]},{value:"Verify the authenticity of your Agora node&#39;s checkpoint",id:"verify-the-authenticity-of-your-agora-nodes-checkpoint",children:[]},{value:"Frequently asked questions",id:"frequently-asked-questions",children:[]}],m={toc:h};function k(e){var t=e.components,n=(0,o.Z)(e,l);return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"Public Preview")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("strong",{parentName:"p"},"This feature is currently in public preview")," and may change significantly as we receive feedback from users like you. Join our ",(0,r.kt)("a",{parentName:"p",href:"https://t.me/bosagora_eng"},"Bosagora Telegram")," to share your feedback."))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Checkpoint sync")," is a feature that significantly speeds up the initial sync between your Agora node and the Agora Chain. With checkpoint sync configured, your Agora node will begin syncing from a recently finalized checkpoint instead of syncing from genesis. This can make installations, validator migrations, recoveries, and testnet deployments ",(0,r.kt)("em",{parentName:"p"},"way")," faster."),(0,r.kt)("p",null,"To sync from a checkpoint, your Agora-cl Agora node needs three pieces of information: the latest finalized ",(0,r.kt)("inlineCode",{parentName:"p"},"BeaconState"),", the ",(0,r.kt)("inlineCode",{parentName:"p"},"SignedBeaconBlock"),", and (if you're on a testnet) the genesis state for the network you're using. Together, the ",(0,r.kt)("inlineCode",{parentName:"p"},"BeaconState")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"SignedBeaconBlock")," represent a single ",(0,r.kt)("strong",{parentName:"p"},"checkpoint state"),"."),(0,r.kt)("p",null,"These three pieces of information can be retrieved either via a ",(0,r.kt)("strong",{parentName:"p"},"network request"),", or via ",(0,r.kt)("strong",{parentName:"p"},"file export/import"),". Syncing via network is the method we recommend to most users because it's more straightforward."),(0,r.kt)("p",null,"After configuring checkpoint sync, we strongly recommend ","[verifying the authenticity of your Agora node's checkpoint]",'(#verify-the-authenticity-of-your-agora-cl nodes-checkpoint) as a way to "trust but verify" the integrity of your checkpoint data.'),(0,r.kt)("h2",{id:"option-1-configure-checkpoint-sync-via-network-request"},"Option 1: Configure checkpoint sync via network request"),(0,r.kt)("p",null,"Start your Agora-cl Agora node with the ",(0,r.kt)("inlineCode",{parentName:"p"},"--checkpoint-sync-url")," flag set to a fully synced Agora node's RPC gateway provider endpoint. This endpoint is usually exposed via port ",(0,r.kt)("inlineCode",{parentName:"p"},"3500"),". Set the ",(0,r.kt)("inlineCode",{parentName:"p"},"--genesis-beacon-api-url")," flag to the same URL if you want to fetch the genesis state along with the ",(0,r.kt)("inlineCode",{parentName:"p"},"BeaconState")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"SignedBeaconBlock"),"."),(0,r.kt)("p",null,"The following command starts a Agora node with checkpoint sync configured to pull checkpoint state from another local Agora node's RPC endpoint using port ",(0,r.kt)("inlineCode",{parentName:"p"},"3500"),":"),(0,r.kt)(i.Z,{groupId:"os",defaultValue:"others",values:[{label:"Windows",value:"win"},{label:"Linux, MacOS, Arm64",value:"others"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"win",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"./agora-cl.bat beacon-chain --checkpoint-sync-url=http://localhost:3500 --genesis-beacon-api-url=http://localhost:3500\n"))),(0,r.kt)(s.Z,{value:"others",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./agora-cl.sh beacon-chain --checkpoint-sync-url=http://localhost:3500 --genesis-beacon-api-url=http://localhost:3500\n")))),(0,r.kt)("p",null,"To confirm that checkpoint sync has succeeded, look for the following output:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'level=info msg="requesting <your configured checkpoint sync endpoint>"\n')),(0,r.kt)("h3",{id:"serve-checkpoint-sync-requests"},"Serve checkpoint sync requests"),(0,r.kt)("p",null,"The above instructions tell you how to ",(0,r.kt)("strong",{parentName:"p"},"request")," checkpoint state from another node. If you want to ",(0,r.kt)("strong",{parentName:"p"},"serve")," these requests, run a fully synced node with the following flags:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"--enable-debug-rpc-endpoints"),": The ",(0,r.kt)("a",{parentName:"li",href:"https://ethereum.github.io/beacon-APIs/#/Debug/getStateV2"},"Agora Node API for retrieving a BeaconState")," is a debug endpoint - this flag tells Agora-cl to enable the endpoint so checkpoint sync requests can be served through your Agora node's RPC gateway provider endpoint.")),(0,r.kt)("p",null,"Note that ",(0,r.kt)("strong",{parentName:"p"},"this is entirely optional"),". The Agora node ",(0,r.kt)("em",{parentName:"p"},"requesting")," the checkpoint state from this node doesn't need these flags."),(0,r.kt)("h2",{id:"option-2-advanced-configure-checkpoint-sync-via-file-exportimport"},"Option 2 (Advanced): Configure checkpoint sync via file export/import"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},(0,r.kt)("inlineCode",{parentName:"p"},"Go")," needs to be installed on the machine that hosts your synced Agora node if you use this method. See ",(0,r.kt)("a",{parentName:"p",href:"https://go.dev/"},"go.dev")," for installation instructions."))),(0,r.kt)("p",null,"When you sync via ",(0,r.kt)("strong",{parentName:"p"},"network request"),", the ",(0,r.kt)("inlineCode",{parentName:"p"},"BeaconState"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"SignedBeaconBlock"),", and genesis state files are delivered from one Agora node to another using a peer-to-peer connection. When you sync via ",(0,r.kt)("strong",{parentName:"p"},"file export/import"),", you manually export these files from one Agora node and import them into another. This can be useful if you don't want your Agora node to expose an RPC gateway provider endpoint. Block explorers and client teams can also host these exported files statically as a trusted checkpoint sync source."),(0,r.kt)("p",null,"Issue the following commands to export the ",(0,r.kt)("inlineCode",{parentName:"p"},"BeaconState")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"SignedBeaconBlock")," files from a synced Agora node using ",(0,r.kt)("inlineCode",{parentName:"p"},"prysmctl"),". Until ",(0,r.kt)("inlineCode",{parentName:"p"},"prysmctl")," is included in Agora-cl's binary release package, it is necessary to run it from a local source checkout:"),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"Installing ",(0,r.kt)("inlineCode",{parentName:"p"},"prysmctl")," via ",(0,r.kt)("inlineCode",{parentName:"p"},"agora-cl.sh"),", or downloading it from agora-cl's github release page, will be possible in an upcoming stable release."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ git clone git@github.com:zeroone-boa/agora-cl.git\nCloning into 'agora-cl'...\nremote: Enumerating objects: 167386, done.\nremote: Counting objects: 100% (332/332), done.\nremote: Compressing objects: 100% (234/234), done.\nremote: Total 167386 (delta 118), reused 220 (delta 93), pack-reused 167054\nReceiving objects: 100% (167386/167386), 154.30 MiB | 39.56 MiB/s, done.\nResolving deltas: 100% (127482/127482), done.\n\n$ go run github.com/zeroone-boa/agora-cl/v3/cmd/prysmctl checkpoint-sync download --agora-cl node-host=http://localhost:3500\n")),(0,r.kt)("p",null,"You should see the following output if your export was successful:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"INFO[0000] requesting http://localhost:3500/eth/v2/debug/beacon/states/finalized\nINFO[0001] detected supported config in remote finalized state, name=goerli, fork=bellatrix\nINFO[0001] requesting http://localhost:3500/eth/v2/beacon/blocks/0x766bdce4c70b6ee991bd68f8065d73e3990895b1953f6b931baae0502d8cbfcf\nINFO[0001] BeaconState slot=3041920, Block slot=3041920\nINFO[0001] BeaconState htr=0x34ebc10f191706afbbccb0c3c39679632feef0453fe842bda264e432e9e31011d, Block state_root=0x34ebc10f191706afbbccb0c3c39679632feef0453fe842bda264e432e9e31011\nINFO[0001] BeaconState latest_block_header htr=0x766bdce4c70b6ee991bd68f8065d73e3990895b1953f6b931baae0502d8cbfcfd, block htr=0x766bdce4c70b6ee991bd68f8065d73e3990895b1953f6b931baae0502d8cbfcf\nINFO[0001] saved ssz-encoded block to to block_goerli_bellatrix_3041920-0x766bdce4c70b6ee991bd68f8065d73e3990895b1953f6b931baae0502d8cbfcf.ssz\nINFO[0001] saved ssz-encoded state to to state_goerli_bellatrix_3041920-0x34ebc10f191706afbbccb0c3c39679632feef0453fe842bda264e432e9e31011.ssz\n")),(0,r.kt)("p",null,"The two exported ",(0,r.kt)("inlineCode",{parentName:"p"},"*.ssz")," files are your ",(0,r.kt)("inlineCode",{parentName:"p"},"BeaconState")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"SignedBeaconBlock")," files. Their filenames combine their file type (",(0,r.kt)("inlineCode",{parentName:"p"},"state"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"block"),"), the network (",(0,r.kt)("inlineCode",{parentName:"p"},"goerli"),"), the fork name (",(0,r.kt)("inlineCode",{parentName:"p"},"bellatrix"),"), the slot (",(0,r.kt)("inlineCode",{parentName:"p"},"2397120"),") and the state or block root in hex encoding. The ",(0,r.kt)("inlineCode",{parentName:"p"},"checkpoint save")," command doesn't export the required genesis state, but the genesis state can be downloaded via ",(0,r.kt)("inlineCode",{parentName:"p"},"curl")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"wget")," using the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'curl -H "Accept: application/octet-stream"  http://localhost:3500/eth/v1/debug/beacon/states/genesis > genesis.ssz\n')),(0,r.kt)("p",null,"You can also just manually download the genesis state from GitHub: ",(0,r.kt)("a",{parentName:"p",href:"https://agora-testnet.s3.ap-southeast-1.amazonaws.com/testnet-genesis.ssz"},"Goerli-Prater")," | ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/eth-clients/merge-testnets/blob/main/sepolia/genesis.ssz"},"Sepolia")," | ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/eth-clients/merge-testnets/blob/main/ropsten-beacon-chain/genesis.ssz"},"Ropsten")),(0,r.kt)("p",null,"Use the following command to start your Agora node with checkpoint sync configured to use this checkpoint state:"),(0,r.kt)(i.Z,{groupId:"os",defaultValue:"others",values:[{label:"Windows",value:"win"},{label:"Linux, MacOS, Arm64",value:"others"}],mdxType:"Tabs"},(0,r.kt)(s.Z,{value:"win",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./agora-cl.bat beacon-chain \\\n--checkpoint-block=$PWD/block_goerli_bellatrix_3041920-0x766bdce4c70b6ee991bd68f8065d73e3990895b1953f6b931baae0502d8cbfcf.ssz \\\n--checkpoint-state=$PWD/state_goerli_bellatrix_3041920-0x34ebc10f191706afbbccb0c3c39679632feef0453fe842bda264e432e9e31011.ssz \\\n--genesis-state=$PWD/genesis.ssz\n"))),(0,r.kt)(s.Z,{value:"others",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./agora-cl.sh beacon-chain \\\n--checkpoint-block=$PWD/block_goerli_bellatrix_3041920-0x766bdce4c70b6ee991bd68f8065d73e3990895b1953f6b931baae0502d8cbfcf.ssz \\\n--checkpoint-state=$PWD/state_goerli_bellatrix_3041920-0x34ebc10f191706afbbccb0c3c39679632feef0453fe842bda264e432e9e31011.ssz \\\n--genesis-state=$PWD/genesis.ssz\n")))),(0,r.kt)("h2",{id:"verify-the-authenticity-of-your-agora-nodes-checkpoint"},"Verify the authenticity of your Agora node's checkpoint"),(0,r.kt)("p",null,"To verify that the checkpoint state you're using is legitimate, follow these steps after starting your Agora node with checkpoint sync enabled:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to ",(0,r.kt)("inlineCode",{parentName:"li"},"http://localhost:3500/eth/v1/beacon/headers/finalized")," using your browser."),(0,r.kt)("li",{parentName:"ol"},"Find the ",(0,r.kt)("inlineCode",{parentName:"li"},"slot")," number and ",(0,r.kt)("inlineCode",{parentName:"li"},"state_root")," value."),(0,r.kt)("li",{parentName:"ol"},"Use a trusted blockchain explorer to verify the ",(0,r.kt)("inlineCode",{parentName:"li"},"state_root"),". To be extra safe, follow this procedure using multiple blockchain explorers. Using ",(0,r.kt)("inlineCode",{parentName:"li"},"beaconcha.in")," as an example, navigate to one of the following pages, replacing ",(0,r.kt)("inlineCode",{parentName:"li"},"SLOT")," with the ",(0,r.kt)("inlineCode",{parentName:"li"},"slot")," you pulled from your browser:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Testnet: ",(0,r.kt)("a",{parentName:"li",href:"https://testnet.agorascan.io/block/SLOT"},"https://testnet.agorascan.io/block/SLOT")),(0,r.kt)("li",{parentName:"ul"},"Mainnet: ",(0,r.kt)("a",{parentName:"li",href:"https://agorascan.io/block/SLOT"},"https://agorascan.io/block/SLOT")))),(0,r.kt)("li",{parentName:"ol"},"Ensure that the ",(0,r.kt)("inlineCode",{parentName:"li"},"state_root")," reported by the blockchain explorer matches the ",(0,r.kt)("inlineCode",{parentName:"li"},"state_root")," you pulled from your browser. If you don't see a match, feel free to reach out to us on ",(0,r.kt)("a",{parentName:"li",href:"https://t.me/bosagora_eng"},"Telegram")," and we'll help you troubleshoot.")),(0,r.kt)("h2",{id:"frequently-asked-questions"},"Frequently asked questions"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Is checkpoint sync less secure than syncing from genesis?")," ",(0,r.kt)("br",null),"\nNo. It's actually considered ",(0,r.kt)("em",{parentName:"p"},"more")," secure thanks to the protections against long-range attacks afforded by ",(0,r.kt)("a",{parentName:"p",href:"https://blog.ethereum.org/2014/11/25/proof-stake-learned-love-weak-subjectivity/"},"Weak Subjectivity"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Does Agora-cl's implementation of checkpoint sync support backfilling?"),"\nAgora-cl's current implementation syncs forward-only. Backfilling will be supported in a future Agora-cl release. Note that backfilling isn't required to run a validator - it's only required if you want to run an archive node, support other peers, or query chain history through your Agora node."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Can I use checkpoint sync on any network?")," ",(0,r.kt)("br",null),"\nYes. Checkpoint sync is a network-agnostic feature. You can even use it on local devnets."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Can I use checkpoint sync with an existing, partially synced database?")," ",(0,r.kt)("br",null),"\nNo - checkpoint sync requires a fresh, unused data directory."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Are there any publicly available, trustworthy checkpoint sync endpoints that I can use?")," ",(0,r.kt)("br",null),"\nThe Bosagora Foundation DevOps team runs a handful of checkpoint sync endpoints that can be used:\nXXX"),(0,r.kt)("p",null,"Feel free to ask on our ",(0,r.kt)("a",{parentName:"p",href:"https://t.me/bosagora_eng"},"Bosagora Telegram")," if you need help identifying a ",(0,r.kt)("strong",{parentName:"p"},"Mainnet")," checkpoint state provider."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Do I need to provide a genesis state when using checkpoint sync on Mainnet?")," ",(0,r.kt)("br",null),"\nNo. Mainnet's genesis state is embedded within Agora-cl."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Will I be able to use Infura as a checkpoint state provider after The Merge?")," ",(0,r.kt)("br",null),"\nYes. You won't be able to use Infura as an execution node endpoint provider post-Merge (see: ",(0,r.kt)("a",{parentName:"p",href:"/docs/prepare-for-merge"},"Prepare for The Merge"),"), but you can use it as a checkpoint state provider post-Merge."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"I started a Agora node with checkpoint sync enabled. Can I have other nodes pull checkpoint state from this node right away, or do I need to wait for it to become fully synced?")," ",(0,r.kt)("br",null),"\nBlock and state are immediately finalized upon import, so your first node should be able to serve checkpoint sync requests to other clients without having to wait."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Does my execution client need to be fully synced before my Agora node can use checkpoint sync?")," ",(0,r.kt)("br",null),"\nSimilar to what happens when you sync from genesis, if your execution client isn't fully synced, your Agora node will go into optimistic sync mode. You'll be able to follow the chain, but any validators connected to your Agora node won't be able to propose."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"How does checkpoint sync relate to weak subjectivity checkpoints?"),"\nAgora-cl offers a ",(0,r.kt)("inlineCode",{parentName:"p"},"--weak-subjectivity-checkpoint")," flag that allows you to specify a weak subjectivity checkpoint. With this flag specified, your Agora node will ensure that it reconstructs a historical chain that matches the checkpoint root at the given epoch. This can offer the same level of weak subjectivity protection that checkpoint sync offers. See ",(0,r.kt)("a",{parentName:"p",href:"https://blog.ethereum.org/2014/11/25/proof-stake-learned-love-weak-subjectivity/"},"Weak Subjectivity")," to learn more."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Where can I learn more about checkpoint sync?")," ",(0,r.kt)("br",null)),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.symphonious.net/2022/05/21/checkpoint-sync-safety/"},"Checkpoint Sync Safety")," by Adrian Sutton"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://notes.ethereum.org/@launchpad/checkpoint-sync"},"How to: Checkpoint Sync")," by members of the Ethereum Foundation"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://notes.ethereum.org/@djrtwo/ws-sync-in-practice"},"WS sync in practice")," by Danny Ryan")),(0,r.kt)("p",null,"Special thanks to the authors of ",(0,r.kt)("em",{parentName:"p"},"How to: Checkpoint Sync")," for providing the endpoints and verification procedure used in this guide."),(0,r.kt)(c.M,{mdxType:"RequestUpdateWidget"}))}k.isMDXComponent=!0},6010:(e,t,n)=>{function a(e){var t,n,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=a(e[t]))&&(o&&(o+=" "),o+=n);else for(t in e)e[t]&&(o&&(o+=" "),o+=t);return o}function o(){for(var e,t,n=0,o="";n<arguments.length;)(e=arguments[n++])&&(t=a(e))&&(o&&(o+=" "),o+=t);return o}n.d(t,{Z:()=>o})}}]);