"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6771],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>u});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),d=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},c=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=d(a),u=r,h=m["".concat(l,".").concat(u)]||m[u]||p[u]||o;return a?n.createElement(h,i(i({ref:t},c),{},{components:a})):n.createElement(h,i({ref:t},c))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var d=2;d<o;d++)i[d]=a[d];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},1262:(e,t,a)=>{a.d(t,{Z:()=>o});var n=a(7294),r=a(2263);const o=function(e){var t=e.children,a=e.fallback;return(0,r.Z)().isClient&&null!=t?n.createElement(n.Fragment,null,t()):a||null}},5505:(e,t,a)=>{a.d(t,{M:()=>o});var n=a(7294),r=a(1262),o=function(e){var t=e.commaDelimitedContributors,a=e.lastVerifiedDateString,o=e.lastVerifiedVersionString,i={Chris:"hewison-chris"},s=function(e){return n.createElement("a",{class:"header-badge",href:"https://github.com/"+i[e]},n.createElement("span",{class:"badge-avatar",style:{backgroundImage:"url('https://avatars.githubusercontent.com/"+i[e]+"')"}}),n.createElement("span",{class:"badge-label"},e))};return n.createElement(r.Z,null,(function(){return n.createElement("div",{class:"header-badges"},null!=t?t.split(",").map(s):null,function(e,t){if(null!=e&&null!=t)return n.createElement("a",{class:"header-badge"},n.createElement("span",{class:"badge-avatar emoji-avatar"},"\u2714\ufe0f"),n.createElement("span",{class:"badge-label"},"Last verified on ",n.createElement("strong",null,e)," using Agora-cl ",t))}(a,o),n.createElement("a",{class:"header-badge",href:"https://github.com/Bosagora/documentation/issues/new?title=Docs update request: "+new URL(window.location.href).pathname+"&body=Source: "+window.location.href+"%0A%0ARequest: (how can we help?)"},n.createElement("span",{class:"badge-avatar emoji-avatar"},"\u270f\ufe0f"),n.createElement("span",{class:"badge-label"},"Request an update")))}))}},1144:(e,t,a)=>{a.d(t,{M:()=>o});var n=a(7294),r=a(1262),o=function(e){return function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(e),n.createElement(r.Z,null,(function(){return n.createElement("div",{class:"update-request"},n.createElement("a",{href:"https://https://github.com/zeroone-boa/agora-cl-docs/issues/new?title=Docs update request: "+new URL(window.location.href).pathname+"&body=Source: "+window.location.href+"%0A%0ARequest: (how can we help?)"},"\ud83d\udc3c Request an update"))}))}},1321:(e,t,a)=>{a.r(t),a.d(t,{contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>p,toc:()=>m});var n=a(7462),r=a(3366),o=(a(7294),a(3905)),i=a(5505),s=a(1144),l=["components"],d={id:"grafana-dashboard",title:"Configure dashboarding and alerts with Prometheus and Grafana",sidebar_label:"Configure dashboarding and alerts with Prometheus and Grafana"},c=void 0,p={unversionedId:"agora-cl-usage/monitoring/grafana-dashboard",id:"agora-cl-usage/monitoring/grafana-dashboard",isDocsHomePage:!1,title:"Configure dashboarding and alerts with Prometheus and Grafana",description:"Grafana is an open-source data metrics tool that is used to aggregate large amounts of data into a comprehensive visual dashboard for easy analysis. This section includes instructions for installing Grafana on the local machine and configuring Telegram or Discord alerts for monitoring validator status on-the-go.",source:"@site/docs/agora-cl-usage/monitoring/grafana-dashboard.md",sourceDirName:"agora-cl-usage/monitoring",slug:"/agora-cl-usage/monitoring/grafana-dashboard",permalink:"/docs/agora-cl-usage/monitoring/grafana-dashboard",editUrl:"https://github.com/zeroone-boa/agora-cl-docs/edit/master/website/docs/agora-cl-usage/monitoring/grafana-dashboard.md",version:"current",frontMatter:{id:"grafana-dashboard",title:"Configure dashboarding and alerts with Prometheus and Grafana",sidebar_label:"Configure dashboarding and alerts with Prometheus and Grafana"},sidebar:"docs",previous:{title:"Monitor validators by index",permalink:"/docs/agora-cl-usage/individual-validator-monitoring"},next:{title:"Collect metrics with client-stats",permalink:"/docs/agora-cl-usage/client-stats"}},m=[{value:"Getting account metrics",id:"getting-account-metrics",children:[]},{value:"Installing Prometheus",id:"installing-prometheus",children:[]},{value:"Installing Grafana",id:"installing-grafana",children:[]},{value:"Enabling mobile alerts",id:"enabling-mobile-alerts",children:[{value:"Option 1: Telegram",id:"option-1-telegram",children:[]},{value:"Option 2: Discord",id:"option-2-discord",children:[]}]},{value:"Creating and importing dashboards",id:"creating-and-importing-dashboards",children:[]},{value:"Running nodes and validators on separate hardware",id:"running-nodes-and-validators-on-separate-hardware",children:[]}],u={toc:m};function h(e){var t=e.components,d=(0,r.Z)(e,l);return(0,o.kt)("wrapper",(0,n.Z)({},u,d,{components:t,mdxType:"MDXLayout"}),(0,o.kt)(i.M,{mdxType:"HeaderBadgesWidget"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/"},"Grafana")," is an open-source data metrics tool that is used to aggregate large amounts of data into a comprehensive visual dashboard for easy analysis. This section includes instructions for installing Grafana on the local machine and configuring Telegram or Discord alerts for monitoring validator status on-the-go."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Grafana dashboard for agora-cl node and validator",src:a(4474).Z,title:"Grafana dashboard for agora-cl node and validator"})),(0,o.kt)("h3",{id:"getting-account-metrics"},"Getting account metrics"),(0,o.kt)("p",null," Ensure metrics have been activated by visiting the following dashboards:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Node metrics are found at http://localhost:8080/metrics"),(0,o.kt)("li",{parentName:"ul"},"Validator metrics are found at http://localhost:8081/metrics"),(0,o.kt)("li",{parentName:"ul"},"Slasher metrics are found at http://localhost:8082/metrics")),(0,o.kt)("p",null,"If you are using a custom --monitoring-host for these processes, such as an IP address, then just change ",(0,o.kt)("inlineCode",{parentName:"p"},"localhost")," to the custom host you are using."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note: Running a slasher isn't mandatory for staking, only people that are running a slasher can find the metrics at the port 8082. For those that don't run a slasher, all instructions that follow remain correct.")),(0,o.kt)("h2",{id:"installing-prometheus"},"Installing Prometheus"),(0,o.kt)("p",null,"Prometheus must first be installed to fetch the data from the Agora node and validator for Grafana to display."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/download/"},"Download the Prometheus files")," suited for the host system.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Extract the archive and enter it's new directory.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Locate the ",(0,o.kt)("inlineCode",{parentName:"p"},"prometheus.yml")," file and replace the contents with the following:"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-#",metastring:"my global config",my:!0,global:!0,config:!0},"global:\n  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.\n  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.\n  # scrape_timeout is set to the global default (10s).\n# Alertmanager configuration\nalerting:\n  alertmanagers:\n  - static_configs:\n    - targets:\n      # - alertmanager:9093\n# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.\nrule_files:\n  # - \"first_rules.yml\"\n  # - \"second_rules.yml\"\n# A scrape configuration containing exactly one endpoint to scrape:\n# Here it's Prometheus itself.\nscrape_configs:\n  - job_name: 'validator'\n    static_configs:\n      - targets: ['localhost:8081']\n  - job_name: 'Agora node'\n    static_configs:\n      - targets: ['localhost:8080']\n  - job_name: 'slasher'\n    static_configs:\n      - targets: ['localhost:8082']\n")),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"In the same directory, double-click the ",(0,o.kt)("strong",{parentName:"li"},"prometheus")," file (with extension ",(0,o.kt)("inlineCode",{parentName:"li"},".exe")," in Windows) to start Prometheus,\nor do so in a terminal by issuing the command:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"./prometheus\n")),(0,o.kt)("p",null,"  A terminal will open presenting the Prometheus log."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"NOTICE:")," Prometheus' default data logging time is 15 days. To extend dashboard statistics to 31 days, add ",(0,o.kt)("inlineCode",{parentName:"p"},"--storage.tsdb.retention.time=31d")," to this startup command.")),(0,o.kt)("ol",{start:5},(0,o.kt)("li",{parentName:"ol"},"Navigate to http://localhost:9090/graph in a browser. It will present a page similar to this:\n",(0,o.kt)("img",{alt:"Prometheus page",src:a(2358).Z,title:"Prometheus page"}))),(0,o.kt)("p",null,"Take note of the ",(0,o.kt)("inlineCode",{parentName:"p"},"validator_statuses")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"total_voted_target_balances"),", as they are required later."),(0,o.kt)("h4",{id:"optional-windows-running-prometheus-in-the-background"},"(Optional) Windows: Running Prometheus in the background"),(0,o.kt)("p",null,"In a ",(0,o.kt)("strong",{parentName:"p"},"Windows Powershell")," prompt, navigate to the directory the ",(0,o.kt)("inlineCode",{parentName:"p"},"prometheus.exe")," file is saved and issue the command:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'Start-Process "prometheus.exe" "--storage.tsdb.retention.time=31d" -WindowStyle Hidden\n')),(0,o.kt)("p",null,"To stop the prometheus process at any time, open the windows task manager and search for ",(0,o.kt)("inlineCode",{parentName:"p"},"prometheus.exe"),", then end the task."),(0,o.kt)("h2",{id:"installing-grafana"},"Installing Grafana"),(0,o.kt)("p",null,"Grafana must now be installed to provide the graphical component of the data analytics."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/grafana/download"},"Download Grafana")," and install it.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Open http://localhost:3000 in a browser. By default, the username and the password to this panel are both \u2018admin\u2019.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Create a data source and choose Prometheus, then enter in the URL field http://localhost:9090.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"click on ",(0,o.kt)("strong",{parentName:"p"},"Save & Test"),"."))),(0,o.kt)("p",null,"A green notification saying \u201cDatasource updated\u201d should now be visible on the upper right corner."),(0,o.kt)("h2",{id:"enabling-mobile-alerts"},"Enabling mobile alerts"),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"stale content")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"This section is currently out of date. Refer to Grafana's ",(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/blog/2021/06/14/the-new-unified-alerting-system-for-grafana-everything-you-need-to-know/"},"The new unified alerting system for Grafana")," for the latest alert configuration guidance while we update this content."))),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"On the left menu of Grafana, select ",(0,o.kt)("strong",{parentName:"p"},"Notification channels")," under the bell icon.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Click on ",(0,o.kt)("strong",{parentName:"p"},"New channel"),"."))),(0,o.kt)("h3",{id:"option-1-telegram"},"Option 1: Telegram"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Select Telegram from the list.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"To complete the ",(0,o.kt)("strong",{parentName:"p"},"Telegram API settings"),", a Telegram channel and bot are required. For instructions on setting up a bot with ",(0,o.kt)("inlineCode",{parentName:"p"},"@Botfather"),", see ",(0,o.kt)("a",{parentName:"p",href:"https://core.telegram.org/bots#6-botfather"},"this section")," of the Telegram documentation.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Once completed, invite the bot to the newly created channel."))),(0,o.kt)("h3",{id:"option-2-discord"},"Option 2: Discord"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Select ",(0,o.kt)("strong",{parentName:"p"},"Discord")," in the type drop down selection.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"To complete the set up, a Discord server (and a text channel available) as well as a Webhook URL are required. For instructions on setting up a Discord's Webhooks, see ",(0,o.kt)("a",{parentName:"p",href:"https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks"},"this section")," of their documentation.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Navigate back to http://localhost:3000 and enter the Webhook URL in the Discord notification settings panel.")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Click ",(0,o.kt)("strong",{parentName:"p"},"Send Test"),", which will push a confirmation message to the Discord channel."))),(0,o.kt)("h2",{id:"creating-and-importing-dashboards"},"Creating and importing dashboards"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"The dashboard can now be customised to the users preferences. There are two examples that can be used:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.prylabs.network/assets/grafana-dashboards/small_amount_validators.json"},"dashboard designed for small amount of validator keys")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.prylabs.network/assets/grafana-dashboards/big_amount_validators.json"},"dashboard designed for more than 10 validator keys"))),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"To import this json into the Grafana dashboard, click on the ",(0,o.kt)("strong",{parentName:"p"},"+")," icon on the left menu and select 'Import',")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Paste the json and click the ",(0,o.kt)("strong",{parentName:"p"},"Load")," button."))),(0,o.kt)("h2",{id:"running-nodes-and-validators-on-separate-hardware"},"Running nodes and validators on separate hardware"),(0,o.kt)("p",null,"For those running their node and validators on separate machines, simply modify the pasted ",(0,o.kt)("inlineCode",{parentName:"p"},"prometheus.yml")," data from the earlier step and change any instances of ",(0,o.kt)("inlineCode",{parentName:"p"},"localhost")," to the desired IP. For local networks, the ",(0,o.kt)("em",{parentName:"p"},"private IP")," is required. For connections over the internet, the ",(0,o.kt)("em",{parentName:"p"},"public facing IP")," will be required."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/agora-cl-usage/p2p-host-ip/#private-ip-addresses"},"Finding a ",(0,o.kt)("strong",{parentName:"a"},"private IP"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/docs/agora-cl-usage/p2p-host-ip/#public-ip-addresses"},"Finding a ",(0,o.kt)("strong",{parentName:"a"},"public IP")))),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"NOTICE:")," In case of public IPs, ",(0,o.kt)("a",{parentName:"p",href:"/docs/agora-cl-usage/p2p-host-ip/#port-forwarding"},"port forwarding")," may need to be configured.")),(0,o.kt)(s.M,{mdxType:"RequestUpdateWidget"}))}h.isMDXComponent=!0},4474:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/dashboard_overview-01f77022876a4297e99bdd0b42e49f5d.png"},2358:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/prometheus_page-ee051b0585bf5e6364853b5342eeff54.png"}}]);