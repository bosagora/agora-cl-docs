"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[6635],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>u});var n=a(7294);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){o(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},g=n.forwardRef((function(e,t){var a=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),g=c(a),u=o,m=g["".concat(l,".").concat(u)]||g[u]||d[u]||r;return a?n.createElement(m,i(i({ref:t},p),{},{components:a})):n.createElement(m,i({ref:t},p))}));function u(e,t){var a=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=a.length,i=new Array(r);i[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var c=2;c<r;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}g.displayName="MDXCreateElement"},1262:(e,t,a)=>{a.d(t,{Z:()=>r});var n=a(7294),o=a(2263);const r=function(e){var t=e.children,a=e.fallback;return(0,o.Z)().isClient&&null!=t?n.createElement(n.Fragment,null,t()):a||null}},5505:(e,t,a)=>{a.d(t,{M:()=>r});var n=a(7294),o=a(1262),r=function(e){var t=e.commaDelimitedContributors,a=e.lastVerifiedDateString,r=e.lastVerifiedVersionString,i={Chris:"hewison-chris"},s=function(e){return n.createElement("a",{class:"header-badge",href:"https://github.com/"+i[e]},n.createElement("span",{class:"badge-avatar",style:{backgroundImage:"url('https://avatars.githubusercontent.com/"+i[e]+"')"}}),n.createElement("span",{class:"badge-label"},e))};return n.createElement(o.Z,null,(function(){return n.createElement("div",{class:"header-badges"},null!=t?t.split(",").map(s):null,function(e,t){if(null!=e&&null!=t)return n.createElement("a",{class:"header-badge"},n.createElement("span",{class:"badge-avatar emoji-avatar"},"\u2714\ufe0f"),n.createElement("span",{class:"badge-label"},"Last verified on ",n.createElement("strong",null,e)," using Agora-cl ",t))}(a,r),n.createElement("a",{class:"header-badge",href:"https://github.com/Bosagora/documentation/issues/new?title=Docs update request: "+new URL(window.location.href).pathname+"&body=Source: "+window.location.href+"%0A%0ARequest: (how can we help?)"},n.createElement("span",{class:"badge-avatar emoji-avatar"},"\u270f\ufe0f"),n.createElement("span",{class:"badge-label"},"Request an update")))}))}},1144:(e,t,a)=>{a.d(t,{M:()=>r});var n=a(7294),o=a(1262),r=function(e){return function(e){if(null==e)throw new TypeError("Cannot destructure undefined")}(e),n.createElement(o.Z,null,(function(){return n.createElement("div",{class:"update-request"},n.createElement("a",{href:"https://https://github.com/zeroone-boa/agora-cl-docs/issues/new?title=Docs update request: "+new URL(window.location.href).pathname+"&body=Source: "+window.location.href+"%0A%0ARequest: (how can we help?)"},"\ud83d\udc3c Request an update"))}))}},2118:(e,t,a)=>{a.r(t),a.d(t,{contentTitle:()=>p,default:()=>m,frontMatter:()=>c,metadata:()=>d,toc:()=>g});var n=a(7462),o=a(3366),r=(a(7294),a(3905)),i=a(5505),s=a(1144),l=["components"],c={id:"agora-cl-public-api",title:"Agora-cl public API",sidebar_label:"Agora-cl-specific API",description:"This section contains service definitions and gRPC instructions to interact with the Agora-cl public API."},p=void 0,d={unversionedId:"how-agora-cl-works/agora-cl-public-api",id:"how-agora-cl-works/agora-cl-public-api",isDocsHomePage:!1,title:"Agora-cl public API",description:"This section contains service definitions and gRPC instructions to interact with the Agora-cl public API.",source:"@site/docs/how-agora-cl-works/agora-cl-public-api.md",sourceDirName:"how-agora-cl-works",slug:"/how-agora-cl-works/agora-cl-public-api",permalink:"/docs/how-agora-cl-works/agora-cl-public-api",editUrl:"https://github.com/zeroone-boa/agora-cl-docs/edit/master/website/docs/how-agora-cl-works/agora-cl-public-api.md",version:"current",frontMatter:{id:"agora-cl-public-api",title:"Agora-cl public API",sidebar_label:"Agora-cl-specific API",description:"This section contains service definitions and gRPC instructions to interact with the Agora-cl public API."},sidebar:"docs",previous:{title:"Eth Beacon Node API",permalink:"/docs/how-agora-cl-works/ethereum-public-api"},next:{title:"Keymanager APIs",permalink:"/docs/how-agora-cl-works/keymanager-api"}},g=[{value:"Calling the API on your local Agora node",id:"calling-the-api-on-your-local-agora-node",children:[]},{value:"Disabling the API",id:"disabling-the-api",children:[]},{value:"RESTful endpoints (gRPC Transcoding)",id:"restful-endpoints-grpc-transcoding",children:[{value:"JSON mapping",id:"json-mapping",children:[]},{value:"gRPC tooling and resources",id:"grpc-tooling-and-resources",children:[]}]}],u={toc:g};function m(e){var t=e.components,c=(0,o.Z)(e,l);return(0,r.kt)("wrapper",(0,n.Z)({},u,c,{components:t,mdxType:"MDXLayout"}),(0,r.kt)(i.M,{mdxType:"HeaderBadgesWidget"}),(0,r.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"This API is only used by Agora-cl")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"For a standard API that all Agora-cl nodes implement, see ",(0,r.kt)("a",{parentName:"p",href:"/docs/how-agora-cl-works/ethereum-public-api"},"here"),". Over the next few quarters, we plan on deprecating this API and replacing it with the standard API."))),(0,r.kt)("p",null,"One of the required components of nodes in the Ethereum Agora chain network is to expose an API server for outside interaction. This API is critical for running validators on Ethereum, as validator clients can connect to nodes and query their API to figure out their assigned duties, to submit block proposals, and more. Agora-cl's Ethereum consensus API schema is maintained in Agora-cl itself here: ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/zeroone-boa/agora-cl/tree/develop/proto"},"github.com/zeroone-boa/agora-cl/proto")," and is implemented by Agora-cl beacon nodes and validators."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"gRPC",src:a(3146).Z})),(0,r.kt)("p",null,"Agora-cl implements its API by using the popular ",(0,r.kt)("a",{parentName:"p",href:"https://grpc.io"},"gRPC")," project created by Google, providing highly advanced functionality for Ethereum consensus. Interacting with the API requires the use of protocol buffers, also known as protobuf. These ",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/protocol-buffers/"},"protocol buffer"),". For information on the functionality of gRPC and protocol buffers more generally, see the ",(0,r.kt)("a",{parentName:"p",href:"https://grpc.io/docs/guides/"},"gRPC guide"),"."),(0,r.kt)("h2",{id:"calling-the-api-on-your-local-agora-node"},"Calling the API on your local Agora node"),(0,r.kt)("div",{className:"admonition admonition-danger alert alert--danger"},(0,r.kt)("div",{parentName:"div",className:"admonition-heading"},(0,r.kt)("h5",{parentName:"div"},(0,r.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,r.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,r.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"Do not publicly expose the API")),(0,r.kt)("div",{parentName:"div",className:"admonition-content"},(0,r.kt)("p",{parentName:"div"},"The API's purpose is a means of communication between your Agora node and your validator client. Because of this it is not protected against external malicious users. Some endpoints are vulnerable to Denial-of-Service attacks, while others may disclose information about your Agora node. The communication between the Agora node and the validator client should be done privately, either on the same machine or through an SSH connection."))),(0,r.kt)("p",null,"By default, the Agora node exposes a ",(0,r.kt)("a",{parentName:"p",href:"https://grpc.io"},"gRPC")," API on host ",(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1:4000"),", which is accessed by the validator client. This is not an HTTP endpoint, so you will not be able to perform API queries via HTTP on that port. However, we also expose a JSON-HTTP endpoint on ",(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1:3500")," by default for your needs. If you want to query information such as the chainhead from your local Agora node, you can call:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"http://127.0.0.1:3500/eth/v1alpha1/beacon/chainhead\n")),(0,r.kt)("h2",{id:"disabling-the-api"},"Disabling the API"),(0,r.kt)("p",null,"By default the Agora node runs with all available set of APIs enabled. You might want to disable one or more APIs, for example for security reasons. The ",(0,r.kt)("inlineCode",{parentName:"p"},"--http-modules")," flags allows fine-grained control over which APIs are available on your node."),(0,r.kt)("h2",{id:"restful-endpoints-grpc-transcoding"},"RESTful endpoints ","(","gRPC Transcoding",")"),(0,r.kt)("p",null,"All of the gRPC services should define JSON over HTTP endpoints by specifying ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/googleapis/googleapis/blob/master/google/api/http.proto"},"HTTPRules"),". Developers may choose to bundle a REST service of gRPC with their client implementation binaries, or alternatively, they may use a JSON encoding proxy such as ",(0,r.kt)("a",{parentName:"p",href:"https://www.envoyproxy.io/"},"Envoy Proxy"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/grpc-ecosystem/grpc-gateway"},"grpc-gateway"),", etc."),(0,r.kt)("p",null,"For more information on gRPC transcoding, see the examples found ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/googleapis/googleapis/blob/master/google/api/http.proto#L45"},"here"),"."),(0,r.kt)("p",null,"Code sample:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},'service Messaging {\n    rpc GetMessage(GetMessageRequest) returns (Message) {\n        option (google.api.http) = {\n            get: "/v1/{name=messages/*}"\n        };\n    }\n}\nmessage GetMessageRequest {\n    string name = 1; // Mapped to URL Path.\n}\nmessage Message {\n    string text = 1; // The resource content.\n}\n')),(0,r.kt)("p",null,"This enables an HTTP REST to gRPC mapping, as shown below:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},"HTTP"),(0,r.kt)("th",{parentName:"tr",align:"left"},"gRPC"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},"GET /v1/messages/123456")),(0,r.kt)("td",{parentName:"tr",align:"left"},(0,r.kt)("inlineCode",{parentName:"td"},'GetMessage(name: "messages/123456")'))))),(0,r.kt)("h3",{id:"json-mapping"},"JSON mapping"),(0,r.kt)("p",null,"The majority of field primitive types for Ethereum are either ",(0,r.kt)("inlineCode",{parentName:"p"},"bytes")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"uint64"),". The canonical JSON mapping for those fields are a Base64 encoded string for ",(0,r.kt)("inlineCode",{parentName:"p"},"bytes"),", or a string representation of ",(0,r.kt)("inlineCode",{parentName:"p"},"uint64"),". Since JavaScript loses precision for values over ",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER"},"MAX","_","SAFE","_","INTEGER"),", uint64 must be a JSON string in order to accommodate those values. If the field value has not changed and is still set to protobuf's default, this field will be omitted from the JSON encoding entirely."),(0,r.kt)("p",null,"For more details on JSON mapping for other types, view the relevant section in the ",(0,r.kt)("a",{parentName:"p",href:"https://developers.google.com/protocol-buffers/docs/proto3#json"},"proto3 language guide"),"."),(0,r.kt)("h3",{id:"grpc-tooling-and-resources"},"gRPC tooling and resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/grpc-ecosystem/awesome-grpc"},"Awesome gRPC")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://cloud.google.com/apis/design/"},"Google's API Style Guide")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/protocol-buffers/docs/proto3"},"Language reference for protoc3")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://developers.google.com/protocol-buffers/docs/gotutorial"},"Protocol Buffer Basics: Go")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://blog.jdriven.com/2018/11/transcoding-grpc-to-http-json-using-envoy/"},"Transcoding gRPC to JSON/HTTP using Envoy"))),(0,r.kt)(s.M,{mdxType:"RequestUpdateWidget"}))}m.isMDXComponent=!0},3146:(e,t,a)=>{a.d(t,{Z:()=>n});const n="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIwAAACMCAMAAACZHrEMAAAASFBMVEUtprD///8UoawkpK7X6+3J5Of2+/zA4ONxvcR7wchSsroAnqnc7u87q7X6/f3l8/Tu9/ih0dZoucGv2NyXzdKMyM63299etb45DUVfAAAD9UlEQVR4nO2Y26KjIAxFMdjWilpq1f7/n45AIhdFbc/MnJfsJ40alxggiRAsFovFYrFYLBaLxWKxWCwWi8VisVgs1r+SBDULZGTykuGFnD3n6GOU+0UXxbUcBCy252XRNLzV4h5u3v7sAUJHIIfyahyNX+NANTtAvcg5XIpQelR0oQvt3RDQqMHb7yp9zSmpV+j9IeQWTFE0+K1wje2PZQxU9MjrGxp4xc41bMMUD7UJQw8IdYvtT8i9MivZpy+9wTYM/sIVDD4gq9Ren4wb2dKN6rF6qXWCMN2s5UI4MqHdPrB2dDk3NLIu/JEb6x5Ui+M8gYfpzUSt8cJTehgzg2WllwfIUdkqVSHnuZEBXZQYAU/HYqcihrIOYCpjl3ihAQ9jXySFe2D2Jd1M6swaAAh2P0NjQ20IQ2N0Iyr9F4Uwy4UURsBEJ3hkR5Xm1ZkQxlBzoVHa47fzrfQSGzEMNPasTWHkSK7A/crRjZgbpteZoCmCv9F4sPns4d8Zw2AEyRSmIjvCuD+DjNMxDFDYmymZwOgcjH/VFkz1NYyo3a3VezUyorYKxuIIpid7BCNa66c9ZoljJoYR0mgDxp9tjcwKxvv5CcyiBMbHeQxz3/xNH+gLGOWWMXshmtpPgvx/MOCi7Lpa9Pxa8FMYNedqqiSYILMLYHp7k2NxOyJtB8beuk/pIIUJ00TvcwemKY2uCCNHdz6rCaa2MTa0JfbB3mTsGu2XFEbeF2eoKTdi681+hgnTmgAmVGO3s3UK4dbCjXUm1CMzNjgFPoZxy8ZGPqPSmNmAoR1nBfP+BqajVTqFubgBO4LJhTas8qBjmAutYQmMxsz7EKbKRs20RFYcwF0KMxvdjFmqAB/A5VzD1FTD7ARwsw/jC7F4aqvVrm2mtj14LKWKn9phFZef2qo+gPFUxykEbgW060UrcOAou+jJvwmDmRKlbb8LI9roP/0yDEZSPLV/Cwa3ZvxP52BaK3v4dgv+WP8VGPw0HZW3uzBh2glU9eY2hM9gqGhwN30KQ4l1IQ51qlTB1TmqtTMw4xrmg5g5U8ThZqbDXXsFM4XAUxRlZm24neiQnCpvhaJNIw+Dq9HVbA8SP4qieV7m9Zl67qjwx7Tz5j87B4OpwFz4Q6+L5J6T7ZGDloiDwXTM/qcMzEae41sivgNzMDT7zSIqVdylVakSOhpSR2dquPSLdttocRFn/lMORqgmdjR+3kY7aDBSS8Rlqle1AyOkDh0N37CI3dYrrQ44P0y7ocvB0Iy249t/x7LXlC4pjYaXbUOPkprSmxEJ7fOnTWmx0673mdxyuluUwY/b9SwWi8VisVgsFovFYrFYLBaLxWKxWCzWkf4AiBIs/pXkh70AAAAASUVORK5CYII="}}]);