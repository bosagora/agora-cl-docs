<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-139640266-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Agora-cl" href="/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">BoltDB database | Agora-cl</title><meta data-react-helmet="true" property="og:url" content="https://agora-cl-docs.bosagora.io/docs/how-agora-cl-works/database-backend-boltdb"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="BoltDB database | Agora-cl"><meta data-react-helmet="true" name="description" content="BoltDB is the persistent key-value store database utilised by the Agora-cl client. A piece of software that Agora-cl initially inherited from its origins as a Geth fork was its storage engine, LevelDB. As a simple embedded key-value store written in Go, LevelDB worked well; however, after observing a number of corruption-related issues, it was decided to survey some other options for the project."><meta data-react-helmet="true" property="og:description" content="BoltDB is the persistent key-value store database utilised by the Agora-cl client. A piece of software that Agora-cl initially inherited from its origins as a Geth fork was its storage engine, LevelDB. As a simple embedded key-value store written in Go, LevelDB worked well; however, after observing a number of corruption-related issues, it was decided to survey some other options for the project."><link data-react-helmet="true" rel="shortcut icon" href="/img/bosagora-logo.png"><link data-react-helmet="true" rel="canonical" href="https://agora-cl-docs.bosagora.io/docs/how-agora-cl-works/database-backend-boltdb"><link data-react-helmet="true" rel="alternate" href="https://agora-cl-docs.bosagora.io/docs/how-agora-cl-works/database-backend-boltdb" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://agora-cl-docs.bosagora.io/docs/how-agora-cl-works/database-backend-boltdb" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.9b7cbe7b.css">
<link rel="preload" href="/assets/js/runtime~main.bf2263fc.js" as="script">
<link rel="preload" href="/assets/js/main.a87cd8b8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/getting-started"><img src="/img/bosagora-logo.png" alt="logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/bosagora-logo.png" alt="logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Agora-cl Documentation</b></a><a href="https://github.com/zeroone-boa/agora-cl/releases/tag/v3.1.1" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">agora_v3.1.1</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/install/install-with-script">Quick Install</a><a href="https://github.com/zeroone-boa/agora-cl" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://t.me/bosagora_eng" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_1ZXk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started">Table of contents</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/install/install-with-script">Quickstart: Run a node</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/prepare-for-merge">Prepare for The Merge</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/security-best-practices">Security best practices</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/agora-cl-usage/parameters">Command-line options</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/monitoring/checking-status">Check node and validator status</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/troubleshooting/issues-errors">Troubleshooting</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Advanced installation guides</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">How-tos</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Developer wiki</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contribute/contribution-guidelines">Contribute to Agora-cl&#x27;s codebase</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contribute/golang-principles">Golang principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reading/golang">Golang resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reading/bazel">About Bazel</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">APIs</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Developer concepts</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devtools/init-state">Initial synchronization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devtools/net-design">Network design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devtools/extending-apis">Extending APIs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/architecture-overview">Architecture overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/agora-cl node">Beacon node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/agora-cl-validator-client">Validator client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/validator-lifecycle">Validator lifecycle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/optimistic-sync">Optimistic sync</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/validator-deposit-contract">Validator deposit contract</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/how-agora-cl-works/database-backend-boltdb">BoltDB database</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/p2p-networking">P2P networking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/bls-cryptography">BLS cryptography</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devtools/end-to-end">End-to-end tests</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Misc</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq">Frequently asked questions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/terminology">Glossary</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">BoltDB database</h1></header><p>BoltDB is the persistent <a href="/docs/terminology#key-value-store">key-value store</a> database utilised by the Agora-cl client. A piece of software that Agora-cl initially inherited from its origins as a <a href="https://geth.ethereum.org/" target="_blank" rel="noopener noreferrer">Geth</a> fork was its storage engine, LevelDB. As a simple embedded <a href="/docs/terminology#key-value-store">key-value store</a> written in Go, LevelDB worked well; however, after observing a number of corruption-related issues, it was decided to survey some other options for the project.</p><p><img alt="BoltDB" src="data:image/png;base64,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"></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="why-boltdb"></a>Why BoltDB?<a class="hash-link" href="#why-boltdb" title="Direct link to heading">#</a></h4><p>There were two main requirements of the new storage engine; it needed to be an embedded environment, and written in Go. After a considerable amount of testing, three options in particular met this criteria as well as performance expectancy: BoltDB, Badger and the old option, LevelDB.</p><p>After testing and benchmarking all three options, Bolt was decided upon as the best option for Agora-cl. Although LevelDB and Badger performed better in write-heavy benchmarks (as expected for an LSM-tree), the difference was not substantial, while BoltDB performed much better on read-heavy benchmarks. Further, though Bolt also consumes more space on disk compared to the other two options, it provides the strongest guarantees against data loss, one of the most crucial goals of the project.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="boltdb-functionality"></a>BoltDB functionality<a class="hash-link" href="#boltdb-functionality" title="Direct link to heading">#</a></h2><p>All database related logic is contained in the <code>db/</code> directory of the Agora-cl repository. Given that BoltDB is a <a href="/docs/terminology#key-value-store">key-value store</a> backend, &#x27;buckets&#x27; (akin to tables in relational databases) are required for data storage. Blocks, transactions, state, proposals and attestations are are all defined in these buckets, in what is known as &#x27;bucket data&#x27;.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="example-bucket-creation"></a>Example: bucket creation<a class="hash-link" href="#example-bucket-creation" title="Direct link to heading">#</a></h3><p>A user wants to create a new bucket named <code>myNewStuffBucket</code> to the database. To perform this action, the bucket data must be added to the template found in <code>db/schema.go</code>, like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// The Schema will define how to store and retrieve data from the db.</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Currently we store blocks by prefixing `block` to their hash and</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// using that as the key to store blocks.</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// `block` + hash -&gt; block</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">//</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// We store the crystallized state using the crystallized state lookup key, and</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// also the genesis block using the genesis lookup key.</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// The canonical head is stored using the canonical head lookup key.</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// The fields below define the suffix of keys in the db.</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">var</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    attestationBucket    </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token function" style="color:rgb(80, 250, 123)">byte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;attestation-bucket&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    blockBucket          </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token function" style="color:rgb(80, 250, 123)">byte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;block-bucket&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    mainChainBucket      </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token function" style="color:rgb(80, 250, 123)">byte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;main-chain-bucket&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    myNewStuffBucket </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token function" style="color:rgb(80, 250, 123)">byte</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">“my</span><span class="token operator">-</span><span class="token builtin" style="color:rgb(189, 147, 249)">new</span><span class="token operator">-</span><span class="token plain">stuff</span><span class="token operator">-</span><span class="token plain">bucket”</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token operator">...</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The newly created bucket is added to the <code>NewDB</code> constructor in <code>db/db.go</code>, like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// NewDB initializes a new DB. If the genesis block and states do not exist, this method creates it.</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">NewDB</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dirPath </span><span class="token builtin" style="color:rgb(189, 147, 249)">string</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">*</span><span class="token plain">BeaconDB</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">error</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> err </span><span class="token operator">:=</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">MkdirAll</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dirPath</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0700</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> err </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> err</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    datafile </span><span class="token operator">:=</span><span class="token plain"> path</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Join</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">dirPath</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&quot;beaconchain.db&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    boltDB</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> err </span><span class="token operator">:=</span><span class="token plain"> bolt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">Open</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">datafile</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token number">0600</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> err </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> err</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    db </span><span class="token operator">:=</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">BeaconDB</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> boltDB</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> DatabasePath</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> dirPath</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> err </span><span class="token operator">:=</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">update</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">func</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">tx </span><span class="token operator">*</span><span class="token plain">bolt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(189, 147, 249)">error</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">createBuckets</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">tx</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> myNewStuffBucket</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> …otherBuckets</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"> err </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token boolean">nil</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> err</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> err</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/zeroone-boa/agora-cl-docs/edit/master/website/docs/how-agora-cl-works/database-backend-boltdb.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/how-agora-cl-works/validator-deposit-contract"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Validator deposit contract</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/how-agora-cl-works/p2p-networking"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">P2P networking »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#boltdb-functionality" class="table-of-contents__link">BoltDB functionality</a><ul><li><a href="#example-bucket-creation" class="table-of-contents__link">Example: bucket creation</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_MyFc" href="/docs/getting-started"><img src="/img/Agora-cl.svg" alt="Agora-cl Docs" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/Agora-cl.svg" alt="Agora-cl Docs" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright © 2022 Bosagora, Validator Deposit Contract 0xXXX</div></div></div></footer></div>
<script src="/assets/js/runtime~main.bf2263fc.js"></script>
<script src="/assets/js/main.a87cd8b8.js"></script>
</body>
</html>