<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-139640266-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Agora-cl" href="/opensearch.xml">
<script src="https://buttons.github.io/buttons.js"></script><title data-react-helmet="true">End-to-end tests | Agora-cl</title><meta data-react-helmet="true" property="og:url" content="https://agora-cl-docs.bosagora.io/docs/devtools/end-to-end"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="End-to-end tests | Agora-cl"><meta data-react-helmet="true" name="description" content="Even the best unit tests won&#x27;t prevent bugs from creeping into the system. They test small pieces of code in isolation, but it might be the interaction between different modules/packages/subsystems that causes issues. Agora-cl consist of two separate components, the Agora chain and the validator, that interact with each other in non-trivial ways. Additionally, the system contacts an Eth1 endpoint to access various information about the Eth1 chain. It is therefore very important to find integration bugs as soon as possible. The way Agora-cl achieves this is through having an E2E (end-to-end) test module. Tests inside this module are ran on every PR build, which greatly increases confidence that new code can safely be merged."><meta data-react-helmet="true" property="og:description" content="Even the best unit tests won&#x27;t prevent bugs from creeping into the system. They test small pieces of code in isolation, but it might be the interaction between different modules/packages/subsystems that causes issues. Agora-cl consist of two separate components, the Agora chain and the validator, that interact with each other in non-trivial ways. Additionally, the system contacts an Eth1 endpoint to access various information about the Eth1 chain. It is therefore very important to find integration bugs as soon as possible. The way Agora-cl achieves this is through having an E2E (end-to-end) test module. Tests inside this module are ran on every PR build, which greatly increases confidence that new code can safely be merged."><link data-react-helmet="true" rel="shortcut icon" href="/img/bosagora-logo.png"><link data-react-helmet="true" rel="canonical" href="https://agora-cl-docs.bosagora.io/docs/devtools/end-to-end"><link data-react-helmet="true" rel="alternate" href="https://agora-cl-docs.bosagora.io/docs/devtools/end-to-end" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://agora-cl-docs.bosagora.io/docs/devtools/end-to-end" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.d023a482.css">
<link rel="preload" href="/assets/js/runtime~main.fbada0f2.js" as="script">
<link rel="preload" href="/assets/js/main.f24723cf.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/getting-started"><img src="/img/bosagora-logo.png" alt="logo" class="themedImage_TMUO themedImage--light_4Vu1 navbar__logo"><img src="/img/bosagora-logo.png" alt="logo" class="themedImage_TMUO themedImage--dark_uzRr navbar__logo"><b class="navbar__title">Agora-cl Documentation</b></a><a href="https://github.com/zeroone-boa/agora-cl/releases/tag/v3.1.1" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">agora_v3.1.1</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/docs/install/install-with-script">Quick Install</a><a href="https://github.com/zeroone-boa/agora-cl" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://t.me/bosagora_eng" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_2i4l react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_iYfV">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_iYfV">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_fBfG"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_lDyR"><button class="clean-btn backToTopButton_i9tI" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh menuWithAnnouncementBar_+O1J"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started">Table of contents</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/install/install-with-script">Quickstart: Run a node</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/prepare-for-merge">Prepare for The Merge</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/security-best-practices">Security best practices</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/agora-cl-usage/parameters">Command-line options</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/monitoring/checking-status">Check node and validator status</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/troubleshooting/issues-errors">Troubleshooting</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Advanced installation guides</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">How-tos</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Concepts</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Developer wiki</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contribute/contribution-guidelines">Contribute to Agora-cl&#x27;s codebase</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/contribute/golang-principles">Golang principles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reading/golang">Golang resources</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/reading/bazel">About Bazel</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">APIs</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Developer concepts</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devtools/init-state">Initial synchronization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devtools/net-design">Network design</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/devtools/extending-apis">Extending APIs</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/architecture-overview">Architecture overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/agora-cl node">Beacon node</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/agora-cl-validator-client">Validator client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/validator-lifecycle">Validator lifecycle</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/optimistic-sync">Optimistic sync</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/validator-deposit-contract">Validator deposit contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/database-backend-boltdb">BoltDB database</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/p2p-networking">P2P networking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how-agora-cl-works/bls-cryptography">BLS cryptography</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/devtools/end-to-end">End-to-end tests</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Misc</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/faq">Frequently asked questions</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/terminology">Glossary</a></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_dC7a">End-to-end tests</h1></header><p>Even the best unit tests won&#x27;t prevent bugs from creeping into the system. They test small pieces of code in isolation, but it might be the interaction between different modules/packages/subsystems that causes issues. Agora-cl consist of two separate components, the Agora chain and the validator, that interact with each other in non-trivial ways. Additionally, the system contacts an Eth1 endpoint to access various information about the Eth1 chain. It is therefore very important to find integration bugs as soon as possible. The way Agora-cl achieves this is through having an E2E (end-to-end) test module. Tests inside this module are ran on every PR build, which greatly increases confidence that new code can safely be merged.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="running-e2e-tests"></a>Running E2E tests<a class="hash-link" href="#running-e2e-tests" title="Direct link to heading">#</a></h2><p>The below command will run E2E tests using the minimal E2E configuration. It will run for 10 epochs. We additionally specify a timeout value and declare <code>--test_output=streamed</code> to output logs for all tests in real time.</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">bazel test //testing/endtoend:go_default_test --//proto:network=minimal --test_filter=TestEndToEnd_MinimalConfig --test_env=E2E_EPOCHS=10 --test_timeout=10000 --test_output=streamed</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="how-are-e2e-tests-special"></a>How are E2E tests special?<a class="hash-link" href="#how-are-e2e-tests-special" title="Direct link to heading">#</a></h2><p>E2E tests are located in <a href="https://github.com/zeroone-boa/agora-cl/tree/develop/testing/endtoend" target="_blank" rel="noopener noreferrer">https://github.com/zeroone-boa/agora-cl/tree/develop/testing/endtoend</a>. They are regular Go tests enhanced by Bazel. The main reason why we need Bazel is to prepare binaries for components executed by the test, including the Agora node and validator. This means we are testing the system as a whole, including all inter-process communication. E2E uses a dedicated beacon config that overrides several important parameters, such as time-related values (we don&#x27;t want the test to take too long given that it&#x27;s supposed to run for several epochs).</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The difference between <code>TestEndToEnd_MinimalConfig</code> and <code>TestEndToEnd_MinimalConfig_ValidatorAtCurrentRelease</code> is that the former runs the latest validator code, whereas the latter run the validator&#x27;s latest release. The idea is to ensure backwards compatibility between <code>HEAD</code> and the latest validator release.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="e2e-building-blocks"></a>E2E building blocks<a class="hash-link" href="#e2e-building-blocks" title="Direct link to heading">#</a></h2><p>There are three main building block types from which E2E tests are constructed: components, evaluators and policies.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="components"></a>Components<a class="hash-link" href="#components" title="Direct link to heading">#</a></h3><p>An E2E component is an abstract concept that represents a service that can be started and whose status can be inspected. It is defined as a Go interface type:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// ComponentRunner defines an interface via which E2E component&#x27;s configuration, execution and termination is managed.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">type ComponentRunner interface {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Start starts a component.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Start(ctx context.Context) error</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    // Started checks whether an underlying component is started and ready to be queried.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Started() &lt;-chan struct{}</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>There are several types that implement this interface and they can all be found in <a href="https://github.com/zeroone-boa/agora-cl/tree/develop/testing/endtoend/components" target="_blank" rel="noopener noreferrer">https://github.com/zeroone-boa/agora-cl/tree/develop/testing/endtoend/components</a>.</p><p>E2E requires appropriate regular version updates for certain components that run on binary such as web3signer. Currently, E2E can only support 1 version of a component at a time.</p><p>Running components correctly is not a simple task. We can&#x27;t simply start up all components at the same time and expect the system to work. The Agora node requires a running boot node to be able to find peers, as well as an Eth1 node with blocks that include deposits for validators that will be used during the test. This means we need a combination of synchronous and asynchronous behavior. This is achieved by the use of goroutines and the <code>ComponentRunner</code> interface inside <code>run()</code> in <a href="https://github.com/zeroone-boa/agora-cl/blob/develop/testing/endtoend/endtoend_test.go" target="_blank" rel="noopener noreferrer">https://github.com/zeroone-boa/agora-cl/blob/develop/testing/endtoend/endtoend_test.go</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="evaluators"></a>Evaluators<a class="hash-link" href="#evaluators" title="Direct link to heading">#</a></h3><p>An E2E evaluator is a type defined as follows:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">// Evaluator defines the structure of the evaluators used to conduct the current beacon state during the E2E.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">type Evaluator struct {</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Name       string</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Policy     func(currentEpoch types.Epoch) bool</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    Evaluation func(conn ...*grpc.ClientConn) error // A variable amount of conns is allowed to be passed in for evaluations to check all nodes if needed.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The purpose of an evaluator is to assert an invariant that the system must hold in order to run properly. Examples of such invariants include the ability to undergo a fork transition or the ability to find peers in the network. All evaluators can be found in <a href="https://github.com/zeroone-boa/agora-cl/tree/develop/testing/endtoend/evaluators" target="_blank" rel="noopener noreferrer">https://github.com/zeroone-boa/agora-cl/tree/develop/testing/endtoend/evaluators</a>.</p><p>Each evaluator has a name, a policy (which we will cover later) and an evaluation function. The evaluation function is the actual code that asserts if the system behaves correctly. If the invariant is broken, an error is returned from the function, and the test is stopped and considered failed.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><ul><li>Evaluators are executed at the beginning of an epoch.</li><li>The list of evaluators to run is specified by each test separately.</li></ul></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="policies"></a>Policies<a class="hash-link" href="#policies" title="Direct link to heading">#</a></h3><p>Not every invariant can be checked at every epoch. As an example, the Altair fork transition invariant should be asserted only after the Altair hard fork occurred. Evaluator timings are controlled with policies, which are simple functions returning boolean values, with <code>true</code> indicating that the evaluator should be ran for a specific epoch. All policies can be found in <a href="https://github.com/zeroone-boa/agora-cl/tree/develop/testing/endtoend/policies" target="_blank" rel="noopener noreferrer">https://github.com/zeroone-boa/agora-cl/tree/develop/testing/endtoend/policies</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="investigating-failures"></a>Investigating failures<a class="hash-link" href="#investigating-failures" title="Direct link to heading">#</a></h2><p>If one or more evaluators fail, we get a console output similar to the following:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">--- FAIL: TestEndToEnd_MinimalConfig (234.18s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/chain_started (14.50s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/finished_syncing_0 (0.00s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/validators_active_epoch_0 (0.00s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/peers_connect_epoch_0 (0.10s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/all_nodes_have_same_head_0 (0.10s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- FAIL: TestEndToEnd_MinimalConfig/healthz_check_epoch_1 (0.00s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/finished_syncing_1 (0.00s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/validators_active_epoch_1 (0.00s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/peers_check_epoch_1 (0.00s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/verify_graffiti_in_blocks_epoch_1 (0.00s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/validators_vote_with_the_majority_1 (0.00s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/all_nodes_have_same_head_1 (0.10s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    --- PASS: TestEndToEnd_MinimalConfig/metrics_check_epoch_1 (0.11s)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FAIL</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">FAIL: //testing/endtoend:go_default_test (see /home/user/.cache/bazel/_bazel_user/ec3daeb6ce0cd7052bf7c79ca31f19c6/execroot/agora-cl/bazel-out/k8-fastbuild-ST-02d640e6fd05/testlogs/testing/endtoend/go_default_test/test.log)</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Target //testing/endtoend:go_default_test up-to-date:</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  bazel-out/k8-fastbuild-ST-02d640e6fd05/bin/testing/endtoend/go_default_test_/go_default_test</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO: Elapsed time: 235.338s, Critical Path: 235.16s</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO: 2 processes: 1 internal, 1 linux-sandbox.</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO: Build completed, 1 test FAILED, 2 total actions</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">//testing/endtoend:go_default_test                                       FAILED in 235.1s</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  /home/user/.cache/bazel/_bazel_user/ec3daeb6ce0cd7052bf7c79ca31f19c6/execroot/agora-cl/bazel-out/k8-fastbuild-ST-02d640e6fd05/testlogs/testing/endtoend/go_default_test/test.log</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">INFO: Build completed, 1 test FAILED, 2 total actions</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>This tells us which evaluator failed (<code>healthz_check_epoch_1</code>), but we don&#x27;t know the reason of the failure. Fortunately, there are several logs that we can inspect. First of all, we can take a look at the main test log, whose path is provided in the output:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">/home/user/.cache/bazel/_bazel_user/ec3daeb6ce0cd7052bf7c79ca31f19c6/execroot/agora-cl/bazel-out/k8-fastbuild-ST-02d640e6fd05/testlogs/testing/endtoend/go_default_test/test.log</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The directory of the <code>test.log</code> file contains a <code>test.output</code> directory, which itself contains a zipped file with logs from several components, including all beacon nodes and validator clients started up during the test. They provide invaluable information about our test run. As an example, let&#x27;s inspect a different error message:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">endtoend_test.go:279: E2E test ended in error: failed to start the ETH1 miner: exit status 1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The uzipped output file contains a <code>eth1-init_miner.log</code> file with the following contents:</p><blockquote><p>Fatal: Failed to read genesis file: open /home/user/.cache/bazel/_bazel_user/ec3daeb6ce0cd7052bf7c79ca31f19c6/sandbox/linux-sandbox/1779/execroot/agora-cl/bazel-out/k8-fastbuild-ST-02d640e6fd05/bin/testing/endtoend/go_default_test_/go_default_test.runfiles/com_github_ethereum_go_ethereum/cmd/geth/geth_/genesiss.json: no such file or directory</p></blockquote><p>The issue here is that our repo contains a static file named <code>genesis.json</code> that we want to use to initialize Geth, but issuing the command has a typo in the word <code>genesis</code> (there is a double <code>s</code> at the end).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_WiXH" id="testing-features"></a>Testing features<a class="hash-link" href="#testing-features" title="Direct link to heading">#</a></h2><p>Agora-cl supports <a href="https://github.com/zeroone-boa/agora-cl/blob/develop/config/features/README.md" target="_blank" rel="noopener noreferrer">feature flags</a>, which are very useful when we want to test a particular feature before making it a standard in production. Sometimes you might want to run E2E with your feature flag enabled. To do this, go to <a href="https://github.com/zeroone-boa/agora-cl/blob/develop/config/features/flags.go" target="_blank" rel="noopener noreferrer">https://github.com/zeroone-boa/agora-cl/blob/develop/config/features/flags.go</a> and append your flag to <code>E2EBeaconChainFlags</code>:</p><div class="codeBlockContainer_J+bg"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#F8F8F2"><span class="token plain">var E2EBeaconChainFlags = []string{</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;--dev&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    &quot;--my-feature&quot;,</span></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/zeroone-boa/agora-cl-docs/edit/master/website/docs/devtools/end-to-end.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_wj+Z"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/how-agora-cl-works/bls-cryptography"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« BLS cryptography</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/audits/phase0"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Security audits Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#running-e2e-tests" class="table-of-contents__link">Running E2E tests</a></li><li><a href="#how-are-e2e-tests-special" class="table-of-contents__link">How are E2E tests special?</a></li><li><a href="#e2e-building-blocks" class="table-of-contents__link">E2E building blocks</a><ul><li><a href="#components" class="table-of-contents__link">Components</a></li><li><a href="#evaluators" class="table-of-contents__link">Evaluators</a></li><li><a href="#policies" class="table-of-contents__link">Policies</a></li></ul></li><li><a href="#investigating-failures" class="table-of-contents__link">Investigating failures</a></li><li><a href="#testing-features" class="table-of-contents__link">Testing features</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a class="footerLogoLink_SRtH" href="/docs/getting-started"><img src="/img/Agora-cl.svg" alt="Agora-cl Docs" class="themedImage_TMUO themedImage--light_4Vu1 footer__logo"><img src="/img/Agora-cl.svg" alt="Agora-cl Docs" class="themedImage_TMUO themedImage--dark_uzRr footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 Bosagora, Validator Deposit Contract 0xXXX</div></div></div></footer></div>
<script src="/assets/js/runtime~main.fbada0f2.js"></script>
<script src="/assets/js/main.f24723cf.js"></script>
</body>
</html>